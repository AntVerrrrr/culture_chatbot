{% load i18n %}
{% load static %}

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    {% load static %}
    <link rel="stylesheet" href="//fonts.googleapis.com/earlyaccess/nanummyeongjo.css">
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css"/>
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    <link rel="stylesheet" href="{% static 'css/chatbot_preview/chatbot_preview.css' %}">
    <link rel="stylesheet" href="{% static 'css/includes/assistant_slider.css' %}">
    <link rel="stylesheet" href="{% static 'css/includes/modal.css' %}">
    <link rel="stylesheet" href="{% static 'css/includes/detail_toggle.css' %}">
</head>
<body>
<div class="page-container">
    {% include "includes/header.html" %}

    <div>
        <div class="preview-card">
            <!-- 이미지 -->
            <div class="preview-photo">
                <img src="{{ assistant.photo.url }}" alt="{{ assistant.name }}" width="150">
            </div>

            <!-- 이름 + 태그 -->
            <div class="preview-info">
                <h2>{{ assistant.name }}</h2>
                <p class="tags">
                    {% for tag in assistant.tags.all|dictsort:"priority" %}
                    #{{ tag.name }}
                    {% endfor %}
                </p>

                <br>

                {% if assistant.greeting %}
                    <p class="desc">[{% trans "인사말" %}]</p>
                    <p class="desc">{{ assistant.greeting|linebreaksbr }}</p>
                {% endif %}
            </div>

            <!-- 메뉴 -->
            <div class="preview-menu">
                <div class="menu-item">
                    <span>
                        <img src="{% static 'image/chatbot_preview/bell.svg' %}" alt="arrow" class="icon-arrow">️
                        {% trans "큐레이션 모드" %}
                    </span>
                    <input type="checkbox" id="curation-toggle" checked>
                </div>

                {# 링크가 1개 이상 있으면 전체 블록 출력 #}
                {% if assistant.links.all %}
                  {% for link in assistant.links.all %}
                    {% if link.is_active %}
                      <a href="{{ link.url }}"
                         class="menu-item link-btn"
                         {% if link.target_blank %}target="_blank" rel="noopener"{% endif %}>
                        <span>
                          <img src="{% static 'image/chatbot_preview/file.svg' %}" alt="arrow" class="icon-arrow">
                          {{ link.title|default:_("자세히보기") }}
                        </span>
                        <img src="{% static 'image/chatbot_preview/arrow.svg' %}" alt="arrow" class="icon-arrow">
                      </a>
                    {% endif %}
                  {% endfor %}
                {% endif %}


<!--                <a href="#" class="menu-item link-btn" data-modal-target="detailModal1">-->
<!--                    <span>-->
<!--                      <img src="{% static 'image/chatbot_preview/file.svg' %}" alt="arrow" class="icon-arrow">-->
<!--                      {% trans "자세히보기1" %}-->
<!--                    </span>-->
<!--                    <img src="{% static 'image/chatbot_preview/arrow.svg' %}" alt="arrow" class="icon-arrow">-->
<!--                </a>-->

<!--                모달 기능-->
<!--                <a href="#" class="menu-item link-btn" data-modal-target="detailModal2">-->
<!--                    <span>-->
<!--                        <img src="{% static 'image/chatbot_preview/file.svg' %}" alt="arrow" class="icon-arrow">-->
<!--                        {% trans "자세히보기2" %}-->
<!--                    </span>-->
<!--                    <img src="{% static 'image/chatbot_preview/arrow.svg' %}" alt="arrow" class="icon-arrow">-->
<!--                </a>-->
<!--===========================================--->
<!--                토글기능-->
<!--                <a href="#" class="menu-item link-btn js-detail-toggle" data-target="#detailBox2">-->
<!--                    <span>-->
<!--                        <img src="{% static 'image/chatbot_preview/file.svg' %}" alt="arrow" class="icon-arrow">-->
<!--                        {% trans "자세히보기2" %}-->
<!--                    </span>-->
<!--                    <img src="{% static 'image/chatbot_preview/arrow.svg' %}" alt="arrow" class="icon-arrow chevron">-->
<!--                </a>-->

<!--                &lt;!&ndash; 펼쳐지는 공간 &ndash;&gt;-->
<!--                <div id="detailBox2" class="detail-box" hidden>-->
<!--                    <p>이곳에 자세한 설명을 적어주세요. 필요하면 이미지/리스트도 넣을 수 있습니다.</p>-->
<!--                </div>-->


            </div>
            <br><br>

            <!-- 현재 어시스턴트에 있는 테그들 중 3번째 테그와 같은 어시스트턴트들 보여주기-->
            {# 추천이 있을 때만 푸터 + 슬라이더 노출 #}
            {% with sec=assistant_sections|first %}
            {% if assistant.show_recommendations and sec and sec.assistants and sec.assistants|length %}
            <div class="preview-footer">
                <p>{% trans "이런 이야기는 어떤가요?" %}</p>
                {% blocktrans with name=assistant.name %}
                {{ name }}과 함께할
                {% endblocktrans %}
            </div>
            {% include "includes/assistant_slider.html" %}
            {% endif %}
            {% endwith %}


            <!-- 링크 (토글 상태에 따라 변경) -->
            <a id="chat-link" href="{% url 'chatbot' assistant.id %}?filesearch=0" class="menu-item link-btn">
                <span>{% trans "채팅 시작" %}</span>
            </a>
        </div>

    </div>

<!--    &lt;!&ndash; Modal 1 &ndash;&gt;-->
<!--    <div id="detailModal1" class="modal" aria-hidden="true" role="dialog" aria-modal="true"-->
<!--         aria-labelledby="detailTitle1">-->
<!--        <div class="modal-backdrop" data-modal-close></div>-->
<!--        <div class="modal-panel" role="document">-->
<!--            <button class="modal-close" aria-label="{% trans '닫기' %}" data-modal-close>&times;</button>-->
<!--            <h3 id="detailTitle1" class="modal-title">{% trans "자세히보기1" %}</h3>-->
<!--            <div class="modal-content">&lt;!&ndash; 비워둠 &ndash;&gt;</div>-->
<!--        </div>-->
<!--    </div>-->

    <!-- Modal 2 -->
    <!--    <div id="detailModal2" class="modal" aria-hidden="true" role="dialog" aria-modal="true"-->
    <!--         aria-labelledby="detailTitle2">-->
    <!--        <div class="modal-backdrop" data-modal-close></div>-->
    <!--        <div class="modal-panel" role="document">-->
    <!--            <button class="modal-close" aria-label="{% trans '닫기' %}" data-modal-close>&times;</button>-->
    <!--            <h3 id="detailTitle2" class="modal-title">{% trans "자세히보기2" %}</h3>-->
    <!--            <div class="modal-content">&lt;!&ndash; 비워둠 &ndash;&gt;</div>-->
    <!--        </div>-->
    <!--    </div>-->


    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script src="{% static 'js/includes/assistant_slider.js' %}"></script>
    <script src="{% static 'js/includes/modal.js' %}"></script>
    <script src="{% static 'js/includes/detail_toggle.js' %}"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
          const toggle = document.getElementById("curation-toggle");
          const chatLink = document.getElementById("chat-link");
          const baseUrl = "{% url 'chatbot' assistant.id %}";

          function updateLink() {
            if (toggle.checked) {
              chatLink.href = baseUrl + "?filesearch=1"; // ON
            } else {
              chatLink.href = baseUrl + "?filesearch=0"; // OFF
            }
          }

          // 초기값 설정
          updateLink();

          // 토글 상태 바뀔 때마다 링크 업데이트
          toggle.addEventListener("change", updateLink);
        });
    </script>
</body>
</html>